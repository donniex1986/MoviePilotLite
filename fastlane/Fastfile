# Fastfile - MoviePilot Mobile 构建配置
# 使用方式:
#   fastlane android     - 仅打包 Android APK
#   fastlane ios         - 仅打包 iOS IPA
#   fastlane build_all   - 打包 iOS + Android
#
# Android 打包需要预先设置环境变量:
#   ANDROID_KEYSTORE_PATH, KEYSTORE_PASSWORD, KEY_ALIAS, KEY_PASSWORD

default_platform(:ios)

desc "构建 Android Release APK"
lane :android do
  sh("flutter", "build", "apk", "--release")
end

desc "构建 iOS Release IPA"
lane :ios do
  # 在 CI 环境中，代码签名已通过 workflow 设置
  # Flutter build ipa 会自动查找 ios/ExportOptions.plist（如果存在）
  # 并自动使用已导入的证书和 provisioning profile
  sh("flutter", "build", "ipa", "--release")
end

desc "构建 iOS 和 Android Release 包"
lane :build_all do
  sh("flutter", "build", "apk", "--release")
  sh("flutter", "build", "ipa")
end
